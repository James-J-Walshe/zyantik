<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Estimating Tool</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="Styles/edit-styles.css">
    <link rel="stylesheet" href="Styles/hover-widget.css">
</head>

<script src="modules/hover-widget.js"></script>
    
<body>
    <div class="app-container">
            <header>
                <div class="header-content">
                    <div class="header-left">
                        <!-- Zyantik Logo -->
                        <div class="header-logo">
                            <img src="images/zyantik-logo.png" alt="Zyantik Logo" style="height: 40px; width: auto;">
                        </div>
                        
                        <!-- Page Title -->
                        <h1 class="header-title">Cost Modelling Tool</h1>
                    </div>
                    
                    <!-- Header Controls with Dropdown Menus -->
                    <div class="header-controls">
                        <!-- Project Functions Menu (Grid Icon) -->
                        <div class="dropdown-menu">
                            <button class="dropdown-toggle" id="projectMenuToggle" title="Project Functions">
                                <svg viewBox="0 0 24 24" style="width: 24px; height: 24px;">
                                    <path d="M3,3H11V11H3V3M13,3H21V11H13V3M3,13H11V21H3V13M13,13H21V21H13V13Z" fill="currentColor"/>
                                </svg>
                            </button>
                            <div class="dropdown-content grid-menu" id="projectMenuContent">
                                <div class="grid-menu-items">
                                    <button class="grid-menu-item" id="newProjectBtn">
                                        <svg viewBox="0 0 24 24">
                                            <path d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z" fill="currentColor"/>
                                        </svg>
                                        <span>New Project</span>
                                    </button>
                                    <button class="grid-menu-item" id="saveBtn">
                                        <svg viewBox="0 0 24 24">
                                            <path d="M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z" fill="currentColor"/>
                                        </svg>
                                        <span>Save Project</span>
                                    </button>
                                    <button class="grid-menu-item" id="downloadBtn">
                                        <svg viewBox="0 0 24 24">
                                            <path d="M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z" fill="currentColor"/>
                                        </svg>
                                        <span>Download</span>
                                    </button>
                                    <button class="grid-menu-item" id="loadBtn">
                                        <svg viewBox="0 0 24 24">
                                            <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20M12,19L8,15H10.5V12H13.5V15H16L12,19Z" fill="currentColor"/>
                                        </svg>
                                        <span>Load Project</span>
                                    </button>
                                    <button class="grid-menu-item" id="exportBtn">
                                        <svg viewBox="0 0 24 24">
                                            <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20M12,10L8,14H10.5V17H13.5V14H16L12,10Z" fill="currentColor"/>
                                        </svg>
                                        <span>Export Excel</span>
                                    </button>
                                    <button class="grid-menu-item" id="mergeFileBtn">
                                        <svg viewBox="0 0 24 24">
                                            <rect x="2" y="7" width="6" height="2" fill="currentColor"/>
                                            <rect x="2" y="15" width="6" height="2" fill="currentColor"/>
                                            <path d="M8,8 C8,8 10,8 12,12 L18,12 M8,16 C8,16 10,16 12,12" stroke="currentColor" stroke-width="2" fill="none"/>
                                            <path d="M18,12 L22,12 M20,10 L22,12 L20,14" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                        <span>Merge File</span>
                                    </button>
                                </div>
                            </div>
                        </div>
            
                        <!-- Settings Menu (Gear Icon) -->
                        <div class="dropdown-menu">
                            <button class="dropdown-toggle" id="settingsMenuToggle" title="Settings">
                                <svg viewBox="0 0 24 24" style="width: 24px; height: 24px;">
                                    <path d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z" fill="currentColor"/>
                                </svg>
                            </button>
                            <div class="dropdown-content" id="settingsMenuContent">
                                <button class="dropdown-item" id="projectInfoBtn">
                                    <svg viewBox="0 0 24 24" style="width: 20px; height: 20px; opacity: 0.6;">
                                        <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" fill="currentColor"/>
                                    </svg>
                                    <span>Project Information</span>
                                </button>
                                <button class="dropdown-item" id="rateCardsBtn">
                                    <svg viewBox="0 0 24 24" style="width: 20px; height: 20px; opacity: 0.6;">
                                        <path d="M11,8C11,9.66 9.66,11 8,11C6.34,11 5,9.66 5,8C5,6.34 6.34,5 8,5C9.66,5 11,6.34 11,8M14,19H18V17H14V19M14,15H18V13H14V15M14,11H18V9H14V11M3,21V19L5,17L7,19V21H3M8,13C5.67,13 1,14.17 1,16.5V19H5V17H9V19H13V16.5C13,14.17 8.33,13 8,13Z" fill="currentColor"/>
                                    </svg>
                                    <span>Rate Cards</span>
                                </button>
                                <button class="dropdown-item" id="currencyBtn">
                                    <svg viewBox="0 0 24 24" style="width: 20px; height: 20px; opacity: 0.6;">
                                        <path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z" fill="currentColor"/>
                                    </svg>
                                    <span>Currency Settings</span>
                                </button>
                            </div>
                        </div>
            
                        <!-- User Menu 
                        Updated so that the user menu is turned off.
                        <div class="dropdown-menu">
                            <button class="user-badge" id="userMenuToggle">
                                <svg viewBox="0 0 24 24" style="width: 20px; height: 20px;">
                                    <path d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z" fill="currentColor"/>
                                </svg>
                                <span id="currentUserName">ADMIN</span>
                            </button>
                            <div class="dropdown-content" id="userMenuContent">
                                <button class="dropdown-item" id="userProfileBtn">
                                    <svg viewBox="0 0 24 24" style="width: 20px; height: 20px; opacity: 0.6;">
                                        <path d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z" fill="currentColor"/>
                                    </svg>
                                    <span>User Profile</span>
                                </button>
                                <button class="dropdown-item" id="featureTogglesBtn">
                                    <svg viewBox="0 0 24 24" style="width: 20px; height: 20px; opacity: 0.6;">
                                        <path d="M17,7H7A5,5 0 0,0 2,12A5,5 0 0,0 7,17H17A5,5 0 0,0 22,12A5,5 0 0,0 17,7M17,15A3,3 0 0,1 14,12A3,3 0 0,1 17,9A3,3 0 0,1 20,12A3,3 0 0,1 17,15Z" fill="currentColor"/>
                                    </svg>
                                    <span>Feature Toggles</span>
                                </button>
                                <div class="dropdown-divider"></div>
                                <button class="dropdown-item" id="logoutBtn">
                                    <svg viewBox="0 0 24 24" style="width: 20px; height: 20px; opacity: 0.6;">
                                        <path d="M16,17V14H9V10H16V7L21,12L16,17M14,2A2,2 0 0,1 16,4V6H14V4H5V20H14V18H16V20A2,2 0 0,1 14,22H5A2,2 0 0,1 3,20V4A2,2 0 0,1 5,2H14Z" fill="currentColor"/>
                                    </svg>
                                    <span>Logout</span>
                                </button>
                            </div>
                        </div> -->
                    </div>
                    
                    <!-- Mobile hamburger menu -->
                    <div class="mobile-menu">
                        <button id="hamburgerBtn" class="btn btn-icon" aria-label="Menu">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                            </svg>
                        </button>
                        <div id="mobileDropdown" class="mobile-dropdown">
                            <button id="newProjectBtnMobile" class="dropdown-item">
                                <span>New Project</span>
                            </button>
                            <button id="saveBtnMobile" class="dropdown-item">
                                <span>Save Project</span>
                            </button>
                            <button id="downloadBtnMobile" class="dropdown-item">
                                <span>Download Project</span>
                            </button>
                            <button id="loadBtnMobile" class="dropdown-item">
                                <span>Load Project</span>
                            </button>
                            <button id="exportBtnMobile" class="dropdown-item">
                                <span>Export to Excel</span>
                            </button>
                            <button id="settingsBtnMobile" class="dropdown-item">
                                <span>Settings</span>
                            </button>
                        </div>
                    </div>
                </div>
            </header>

        <!-- Main App View -->
        <div id="mainApp" class="main-view">
            <nav class="tab-navigation">
                <button class="tab-btn active" data-tab="summary">Summary</button>
                <button class="tab-btn" data-tab="resource-plan">Resource Plan</button>
                <button class="tab-btn" data-tab="internal-resources">Internal Resources</button>
                <button class="tab-btn" data-tab="vendor-costs">Vendor Costs</button>
                <button class="tab-btn" data-tab="tool-costs">Tool Costs</button>
                <button class="tab-btn" data-tab="miscellaneous">Miscellaneous</button>
                <button class="tab-btn" data-tab="risks">Risks & Contingency</button>
            </nav>

            <main class="content">
                <!-- Summary Tab -->
                <div id="summary" class="tab-content active">
                    <h2>Project Cost Summary</h2>
                    
                    <!-- Project Information Summary -->
                    <div class="summary-columns">
                        <div class="project-info-summary">
                            <h3>Project Information</h3>
                            <div class="info-grid">
                                <div class="info-item">
                                    <span class="info-label">Name:</span>
                                    <span class="info-value" id="summaryProjectName">Not specified</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Manager:</span>
                                    <span class="info-value" id="summaryProjectManager">Not specified</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Start Date:</span>
                                    <span class="info-value" id="summaryStartDate">Not specified</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">End Date:</span>
                                    <span class="info-value" id="summaryEndDate">Not specified</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Duration:</span>
                                    <span class="info-value" id="summaryProjectDuration">Not specified</span>
                                </div>
                                <div class="info-item full-width">
                                    <span class="info-label">Description:</span>
                                    <span class="info-value" id="summaryProjectDescription">Not specified</span>
                                </div>
                            </div>
                            
                            <h4 style="margin-bottom: 1rem;">Project Scope</h4>
                            <div class="scope-grid">
                                <div class="scope-item">
                                    <span class="scope-number" id="summaryInternalResourceCount">0</span>
                                    <span class="scope-label">Internal Resources</span>
                                </div>
                                <div class="scope-item">
                                    <span class="scope-number" id="summaryVendorCount">0</span>
                                    <span class="scope-label">Vendors</span>
                                </div>
                                <div class="scope-item">
                                    <span class="scope-number" id="summaryToolCount">0</span>
                                    <span class="scope-label">Tools</span>
                                </div>
                                <div class="scope-item">
                                    <span class="scope-number" id="summaryRiskCount">0</span>
                                    <span class="scope-label">Risks</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="summary-section">
                            <h3>Cost Breakdown</h3>
                            <div class="cost-breakdown">
                                <div class="breakdown-item">
                                    <span>Internal Resources:</span>
                                    <span class="cost" id="summaryInternalCost">$0</span>
                                </div>
                                <div class="breakdown-item">
                                    <span>Vendor Costs:</span>
                                    <span class="cost" id="summaryVendorCost">$0</span>
                                </div>
                                <div class="breakdown-item">
                                    <span>Tool Costs:</span>
                                    <span class="cost" id="summaryToolCost">$0</span>
                                </div>
                                <div class="breakdown-item">
                                    <span>Miscellaneous:</span>
                                    <span class="cost" id="summaryMiscCost">$0</span>
                                </div>
                                <div class="breakdown-item subtotal">
                                    <span>Subtotal:</span>
                                    <span class="cost" id="summarySubtotal">$0</span>
                                </div>
                                <div class="breakdown-item">
                                    <span>Contingency:</span>
                                    <span class="cost" id="summaryContingency">$0</span>
                                </div>
                                <div class="breakdown-item total">
                                    <span>Total Project Cost:</span>
                                    <span class="cost" id="summaryTotal">$0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Resource Plan Tab -->
                <div id="resource-plan" class="tab-content">
                    <h2>Cost Forecast by Month</h2>
                    
                    <div class="forecast-section">
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr id="forecastTableYearHeader" class="year-header-row">
                                        <!-- Year headers will be dynamically generated by JavaScript -->
                                    </tr>
                                    <tr id="forecastTableHeader" class="month-header-row">
                                        <!-- Month headers will be dynamically generated by JavaScript -->
                                    </tr>
                                </thead>
                                <tbody id="forecastTable">
                                    <!-- Data rows will be dynamically generated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Internal Resources Tab -->
                <div id="internal-resources" class="tab-content">
                    <h2>Internal Resources</h2>
                    <div class="section-actions">
                        <button id="addInternalResource" class="btn btn-primary">Add Resource</button>
                        <small>Values are in days per month</small>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr id="internalResourcesYearHeader">
                                    <!-- Year headers will be dynamically generated -->
                                </tr>
                                <tr id="internalResourcesTableHeader">
                                    <!-- Headers will be dynamically generated -->
                                </tr>
                            </thead>
                            <tbody id="internalResourcesTable">
                                <!-- Populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Vendor Costs Tab -->
                <div id="vendor-costs" class="tab-content">
                    <h2>Vendor Costs</h2>
                    <div class="section-actions">
                        <button id="addVendorCost" class="btn btn-primary">Add Vendor Cost</button>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr id="vendorCostsYearHeader">
                                    <!-- Year headers will be dynamically generated -->
                                </tr>
                                <tr id="vendorCostsTableHeader">
                                    <!-- Headers will be dynamically generated -->
                                </tr>
                            </thead>
                            <tbody id="vendorCostsTable">
                                <!-- Populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Tool Costs Tab -->
                <div id="tool-costs" class="tab-content">
                    <h2>Project Tool Costs</h2>
                    <div class="section-actions">
                        <button id="addToolCost" class="btn btn-primary">Add Tool Cost</button>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Tool/Software</th>
                                    <th>Type</th>
                                    <th>Billing</th>
                                    <th>Cost/Period</th>
                                    <th>Quantity</th>
                                    <th>Start Date</th>
                                    <th>End Date</th>
                                    <th>Total Cost</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="toolCostsTable">
                                <!-- Populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Miscellaneous Tab -->
                <div id="miscellaneous" class="tab-content">
                    <h2>Miscellaneous Costs</h2>
                    <div class="section-actions">
                        <button id="addMiscCost" class="btn btn-primary">Add Miscellaneous Cost</button>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>Description</th>
                                    <th>Category</th>
                                    <th>Cost</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="miscCostsTable">
                                <!-- Populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

               <!-- Risks & Contingency Tab -->
                <div id="risks" class="tab-content">
                    <h2>Risks & Contingency</h2>
                    
                    <!-- Contingency Method Selection -->
                    <div style="margin-bottom: 2rem;">
                        <h3 style="margin-bottom: 1rem; color: #4b5563; font-size: 1.1rem;">Calculation Method:</h3>
                        
                        <!-- Radio Buttons (Horizontal Layout) -->
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="contingencyMethodPercentage" name="contingencyMethod" value="percentage" checked>
                                <div class="radio-option-content">
                                    <label class="radio-option-label" for="contingencyMethodPercentage">Percentage-based</label>
                                    <p class="radio-option-description">Apply a fixed percentage to total project cost</p>
                                </div>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="contingencyMethodRiskBased" name="contingencyMethod" value="risk-based">
                                <div class="radio-option-content">
                                    <label class="radio-option-label" for="contingencyMethodRiskBased">Risk-based</label>
                                    <p class="radio-option-description">Use sum of documented risk mitigation costs</p>
                                </div>
                            </div>
                        </div>

                        <!-- Contingency Amount Display (Always Visible, Below Inputs) -->
                        <div class="contingency-display" style="margin-top: 1rem; padding: 1.5rem; background-color: #f0fdf4; border-radius: 8px; border: 1px solid #d1fae5;">
                            <h3 style="color: #059669; font-size: 1rem; margin-bottom: 0.5rem; font-weight: 600;">
                                Contingency Amount: $<span id="contingencyAmount">0</span>
                            </h3>
                            <p style="color: #6b7280; font-size: 0.75rem; margin: 0;">
                                <span id="contingencyMethodLabel">Calculated using: Percentage-based method (10%)</span>
                            </p>
                        </div>

                        <!-- Percentage Input (Conditional Display) -->
                        <div id="percentageContingencyGroup" style="display: block; margin-top: 1.5rem;">
                            <div class="form-group">
                                <label for="contingencyPercentage">Contingency Percentage:</label>
                                <input type="number" id="contingencyPercentage" class="form-control" value="10" min="0" max="100" step="1">
                                <small style="color: #6b7280; margin-left: 0.5rem;">Percentage of total project cost</small>
                            </div>
                        </div>
                    </div>

                    <!-- Risk-based Content (Conditional Display) -->
                    <div id="riskBasedContent" style="display: none;">
                        <div class="section-actions">
                            <button id="addRisk" class="btn btn-primary">Add Risk</button>
                        </div>
                    
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Risk Description</th>
                                        <th>Probability</th>
                                        <th>Impact</th>
                                        <th>Risk Score</th>
                                        <th>Mitigation Cost</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="risksTable">
                                    <!-- Populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Settings View -->
        <div id="settingsApp" class="settings-view" style="display: none;">
            <div class="settings-header">
                <h1>Settings</h1>
                <button id="backToMain" class="btn btn-icon close-settings-btn" title="Back to Project">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                </button>
            </div>
            
            <div class="settings-container">
                <nav class="settings-sidebar">
                    <button class="settings-nav-btn active" data-settings-tab="project-info">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                        </svg>
                        Project Information
                    </button>
                    <button class="settings-nav-btn" data-settings-tab="rate-cards">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M11,8C11,9.66 9.66,11 8,11C6.34,11 5,9.66 5,8C5,6.34 6.34,5 8,5C9.66,5 11,6.34 11,8M14,19H18V17H14V19M14,15H18V13H14V15M14,11H18V9H14V11M3,21V19L5,17L7,19V21H3M8,13C5.67,13 1,14.17 1,16.5V19H5V17H9V19H13V16.5C13,14.17 8.33,13 8,13Z"/>
                        </svg>
                        Rate Cards
                    </button>
                    <button class="settings-nav-btn" data-settings-tab="currency">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/>
                        </svg>
                        Currency
                    </button>
                </nav>
                
                <div class="settings-content">
                    <!-- Project Info Settings -->
                    <div id="settings-project-info" class="settings-tab-content active">
                        <h2>Project Information</h2>
                         
                        <!-- Success/Error Message Container -->
                        <div id="projectInfoMessage" class="project-info-message" style="display: none;"></div>
                            
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="projectName">Project Name:</label>
                                <input type="text" id="projectName" class="form-control" placeholder="Enter project name">
                            </div>
                            <div class="form-group">
                                <label for="startDate">Start Date: <span style="color: red;">*</span></label>
                                <input type="date" id="startDate" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="projectManager">Project Manager:</label>
                                <input type="text" id="projectManager" class="form-control" placeholder="Enter project manager name">
                            </div>
                            <div class="form-group">
                                <label for="endDate">End Date: <span style="color: red;">*</span></label>
                                <input type="date" id="endDate" class="form-control" required>
                            </div>
                            <div class="form-group full-width">
                                <label for="projectDescription">Project Description:</label>
                                <textarea id="projectDescription" class="form-control" rows="4" placeholder="Enter project description"></textarea>
                            </div>
                        </div>

                        <!-- Add Save Button -->
                        <div class="settings-actions" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e0e0e0;">
                            <button id="saveProjectInfoBtn" class="btn btn-primary">Save Project Information</button>
                        </div>
                    </div>

                    <!-- Rate Cards Settings -->
                    <div id="settings-rate-cards" class="settings-tab-content">
                        <h2>Rate Cards</h2>
                        <div class="rate-cards-container">
                            <div class="rate-card-section">
                                <h3>All Rate Cards</h3>
                                <div class="section-actions">
                                    <button id="addRate" class="btn btn-primary">Add Rate Card</button>
                                </div>
                                <div class="table-container">
                                    <table class="data-table">
                                        <thead>
                                            <tr>
                                                <th>Role</th>
                                                <th>Category</th>
                                                <th>Daily Rate</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="rateCardsTable">
                                            <!-- Populated by JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            
                            <!-- Keep old tables for backward compatibility (hidden) -->
                            <div class="rate-card-section" style="display: none;">
                                <h3>Internal Rate Card</h3>
                                <div class="section-actions">
                                    <button id="addInternalRate" class="btn btn-primary">Add Role</button>
                                </div>
                                <div class="table-container">
                                    <table class="data-table">
                                        <thead>
                                            <tr>
                                                <th>Role</th>
                                                <th>Daily Rate</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="internalRatesTable">
                                            <!-- Populated by JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            
                            <div class="rate-card-section" style="display: none;">
                                <h3>External Rate Card</h3>
                                <div class="section-actions">
                                    <button id="addExternalRate" class="btn btn-primary">Add Role</button>
                                </div>
                                <div class="table-container">
                                    <table class="data-table">
                                        <thead>
                                            <tr>
                                                <th>Role</th>
                                                <th>Daily Rate</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="externalRatesTable">
                                            <!-- Populated by JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Currency Settings -->
                    <div id="settings-currency" class="settings-tab-content">
                        <h2>Currency Settings</h2>
                        
                        <!-- Success/Error Message Container -->
                        <div id="currencyMessage" class="project-info-message" style="display: none;"></div>
                        
                        <!-- Primary Currency Section -->
                        <div class="currency-section">
                            <h3>Primary Currency</h3>
                            <p class="section-description">Select the currency that your project will be costed in. All costs will be displayed in this currency.</p>
                            
                            <div class="form-group" style="max-width: 400px;">
                                <label for="primaryCurrencySelect">Project Currency:</label>
                                <select id="primaryCurrencySelect" class="form-control">
                                    <!-- Top 10 most common currencies -->
                                    <optgroup label="Common Currencies">
                                        <option value="USD">ðŸ‡ºðŸ‡¸ USD - US Dollar</option>
                                        <option value="EUR">ðŸ‡ªðŸ‡º EUR - Euro</option>
                                        <option value="GBP">ðŸ‡¬ðŸ‡§ GBP - British Pound</option>
                                        <option value="JPY">ðŸ‡¯ðŸ‡µ JPY - Japanese Yen</option>
                                        <option value="CNY">ðŸ‡¨ðŸ‡³ CNY - Chinese Yuan</option>
                                        <option value="AUD">ðŸ‡¦ðŸ‡º AUD - Australian Dollar</option>
                                        <option value="CAD">ðŸ‡¨ðŸ‡¦ CAD - Canadian Dollar</option>
                                        <option value="CHF">ðŸ‡¨ðŸ‡­ CHF - Swiss Franc</option>
                                        <option value="INR">ðŸ‡®ðŸ‡³ INR - Indian Rupee</option>
                                        <option value="SGD">ðŸ‡¸ðŸ‡¬ SGD - Singapore Dollar</option>
                                    </optgroup>
                                    <!-- Other currencies -->
                                    <optgroup label="Other Currencies">
                                        <option value="AED">ðŸ‡¦ðŸ‡ª AED - UAE Dirham</option>
                                        <option value="ARS">ðŸ‡¦ðŸ‡· ARS - Argentine Peso</option>
                                        <option value="BRL">ðŸ‡§ðŸ‡· BRL - Brazilian Real</option>
                                        <option value="CZK">ðŸ‡¨ðŸ‡¿ CZK - Czech Koruna</option>
                                        <option value="DKK">ðŸ‡©ðŸ‡° DKK - Danish Krone</option>
                                        <option value="HKD">ðŸ‡­ðŸ‡° HKD - Hong Kong Dollar</option>
                                        <option value="HUF">ðŸ‡­ðŸ‡º HUF - Hungarian Forint</option>
                                        <option value="IDR">ðŸ‡®ðŸ‡© IDR - Indonesian Rupiah</option>
                                        <option value="ILS">ðŸ‡®ðŸ‡± ILS - Israeli Shekel</option>
                                        <option value="KRW">ðŸ‡°ðŸ‡· KRW - South Korean Won</option>
                                        <option value="MXN">ðŸ‡²ðŸ‡½ MXN - Mexican Peso</option>
                                        <option value="MYR">ðŸ‡²ðŸ‡¾ MYR - Malaysian Ringgit</option>
                                        <option value="NOK">ðŸ‡³ðŸ‡´ NOK - Norwegian Krone</option>
                                        <option value="NZD">ðŸ‡³ðŸ‡¿ NZD - New Zealand Dollar</option>
                                        <option value="PHP">ðŸ‡µðŸ‡­ PHP - Philippine Peso</option>
                                        <option value="PLN">ðŸ‡µðŸ‡± PLN - Polish Zloty</option>
                                        <option value="RON">ðŸ‡·ðŸ‡´ RON - Romanian Leu</option>
                                        <option value="SEK">ðŸ‡¸ðŸ‡ª SEK - Swedish Krona</option>
                                        <option value="THB">ðŸ‡¹ðŸ‡­ THB - Thai Baht</option>
                                        <option value="TRY">ðŸ‡¹ðŸ‡· TRY - Turkish Lira</option>
                                        <option value="TWD">ðŸ‡¹ðŸ‡¼ TWD - Taiwan Dollar</option>
                                        <option value="ZAR">ðŸ‡¿ðŸ‡¦ ZAR - South African Rand</option>
                                    </optgroup>
                                </select>
                            </div>
                            
                            <div class="currency-preview">
                                <strong>Current Currency:</strong> 
                                <span id="currentCurrencyDisplay" class="currency-badge-large">USD - US Dollar</span>
                            </div>
                        </div>
                        
                        <!-- Exchange Rates Section -->
                        <div class="currency-section" style="margin-top: 2rem;">
                            <h3>Exchange Rates</h3>
                            <p class="section-description">Add currencies that you want to convert to your primary currency. This allows you to add items in different currencies.</p>
                            
                            <div class="section-actions">
                                <button id="addExchangeRate" class="btn btn-primary">Add Currency Exchange</button>
                            </div>
                            
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Currency</th>
                                            <th>Exchange Rate</th>
                                            <th>Last Updated</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="exchangeRatesTable">
                                        <!-- Populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <div class="empty-state" id="exchangeRatesEmptyState" style="display: none;">
                                <h3>No Exchange Rates Added</h3>
                                <p>Click "Add Currency Exchange" to add currencies that you need to convert.</p>
                            </div>
                        </div>
                        
                        <!-- Save Button -->
                        <div class="settings-actions">
                            <button id="saveCurrencySettingsBtn" class="btn btn-primary">Save Currency Settings</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Merge Modal -->
    <div id="mergeModal" class="modal">
        <div class="modal-content merge-modal-content">
            <span class="close" onclick="document.getElementById('mergeModal').style.display='none'">&times;</span>
            <h2>Merge Specialist Team Estimate</h2>
            
            <!-- Step 1: File Upload -->
            <div id="mergeStep1" class="merge-step">
                <h3>Step 1: Select and Validate File</h3>
                <div class="form-group">
                    <label>Upload Specialist Team Project File (.json):</label>
                    <input type="file" id="specialistFileInput" accept=".json" class="form-control" 
                           onchange="window.mergeManager.handleFileUpload(event)">
                    <p class="help-text">Select a project estimate file exported from this tool</p>
                </div>
                <div id="validationResult"></div>
            </div>
            
            <!-- Step 2: Date Comparison -->
            <div id="mergeStep2" class="merge-step" style="display: none;">
                <h3>Step 2: Compare Project Timelines</h3>
                <div id="dateComparisonResult"></div>
            </div>
            
            <!-- Step 3: Date Selection & Merge -->
            <div id="mergeStep3" class="merge-step" style="display: none;">
                <h3>Step 3: Select Timeline and Complete Merge</h3>
                <div id="dateSelectionPanel"></div>
            </div>

            <!-- Step 4: Rate Card Merge -->
            <div id="mergeStep4" style="display: none;">
                <div id="rateCardReviewPanel"></div>
            </div>
        </div>
    </div>
    <!-- Modal for adding items -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3 id="modalTitle">Add Item</h3>
            <form id="modalForm">
                <div id="modalFields">
                    <!-- Dynamic form fields -->
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn btn-primary">Save</button>
                    <button type="button" class="btn btn-secondary" id="cancelModal">Cancel</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Load modules first -->
    <script src="js/dom_manager.js"></script>
    <script src="js/table_renderer.js"></script> 
    <script src="js/data_manager.js"></script>
    <script src="modules/editManager.js"></script>
    <script src="modules/dynamic_form_helper.js"></script>
    <script src="modules/table_fixes.js"></script>
    <script src="modules/new_project_welcome.js"></script>
    <script src="modules/currency_manager.js"></script>
    <!-- <script src="modules/user_manager.js"></script> -->
    <script src="modules/feature_toggle_manager.js"></script>
    <script src="modules/tool_costs_manager.js"></script>
    <script src="modules/rate_card_merger.js"></script>
    <script src="modules/merge_manager.js"></script>
    <script src="modules/multi_resource_manager.js"></script> 
    <script src="modules/analytics_manager.js"></script>
    
    <!-- Load main script (contains functions but no auto-init) -->
    <script src="script.js"></script>
    
    <!-- Load and run initialization manager LAST -->
    <script src="modules/init_manager.js"></script>
    <script>
        // Initialize the app when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                window.initManager.initialize();
            });
        } else {
            // DOM already loaded
            window.initManager.initialize();
        }
    </script>

    <script src="patches/modal_close_fix.js"></script>
    
    <!-- Cookie Consent Banner -->
    <div id="cookieConsent" class="cookie-consent" style="display: none;">
        <div class="cookie-content">
            <p>We use analytics cookies to understand how you use our tool and improve your experience.</p>
            <div class="cookie-buttons">
                <button id="acceptCookies" class="btn btn-primary">Accept</button>
                <button id="declineCookies" class="btn btn-secondary">Decline</button>
            </div>
        </div>
    </div>
</body>
</html>
